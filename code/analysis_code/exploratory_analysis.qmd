---
title: "Exploratory analysis"
author: "Irene Cavros and Chris Okitondo"
date: "02/24/2023"
output: html_document
---

  
  
This Quarto file loads the cleaned data and does some exploring.

As part of the exploratory analysis, we have produced plots, tables, and other summary quantities for some interesting aspects of our data.

# Setup

```{r}
#load needed packages. make sure they are installed.
library(here) #for data loading/saving
library(dplyr)
library(ggplot2)
```


Load the data.

```{r}
#Path to data. Note the use of the here() package and not absolute paths
data_location <- here::here("data","processed_data","processeddata.rds")
#load data
mydata <- readRDS(data_location)
```


### Checking the years included in the data
```{r}
table(processeddata$YEAR)
View(mydata)
```

Because we only covid-19 information for 2020 and 2021. We will omit that variable for now
### Creating a new dataframe without the covid variable 
```{r}
mydata1 <- mydata[,-30]
```


### Ignore the NA values in the dataset
```{r}
mydata2 <- na.omit(mydata1)
```


# Data exploration through tables

Showing a bit of code to produce and save a summary table.

This uses a bit of code trickery to get things into the shape of a data frame (for easier saving/showing in manuscript)

```{r}
summary_df = data.frame(do.call(cbind, lapply(mydata2, summary)))
print(summary_df)
# another way of looking at the data
dplyr::glimpse(mydata2)
# save to file
summarytable_file = here("results", "summarytable.rds")
saveRDS(summary_df, file = summarytable_file)
```

We are saving the results to the `results` folder. Depending on how many tables/figures you have, it might make sense to have separate folders for each. And/or you could have separate folders for exploratory tables/figures and for final tables/figures. Just choose a setup that makes sense for your project and works for you, and provide enough documentation that someone can understand what you are doing.


# Data exploration through figures

Box plots for the flu vaccine uptake and age


```{r}
p1 <- ggplot(mydata2, aes(x=as.factor(flu_vaccine), y=age)) + 
  geom_boxplot(fill = "gray") +
  labs(title = "Distribution of Age per flu vaccine uptake", x = "Uptake of Flu Vaccine in the past 12 months", y = "Age") + scale_fill_discrete(labels=c('No', 'Yes')) + theme_classic()

p1
```


```{r}
figure_file = here("results","age & flu uptake distribution.png")
ggsave(filename = figure_file, plot=p1) 
```


Now weights.

```{r}
p2 <- mydata %>% ggplot(aes(x=Weight)) + geom_histogram() 
plot(p2)
figure_file = here("results","weight_distribution.png")
ggsave(filename = figure_file, plot=p2) 
```

Now height as function of weight.

```{r}
p3 <- mydata %>% ggplot(aes(x=Height, y=Weight)) + geom_point() + geom_smooth(method='lm')
plot(p3)
figure_file = here("results","height_weight.png")
ggsave(filename = figure_file, plot=p3) 
```

Once more height as function of weight, stratified by sex.

```{r}
p4 <- mydata %>% ggplot(aes(x=Height, y=Weight, color = Sex)) + geom_point() + geom_smooth(method='lm')
plot(p4)
figure_file = here("results","height_weight_stratified.png")
ggsave(filename = figure_file, plot=p4) 
```



